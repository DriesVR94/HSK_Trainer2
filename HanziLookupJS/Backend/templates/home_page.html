<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Let's Practice!</title>
  <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@200;400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='home_page.css') }}">
</head>
<body>
    <header>
        <nav>
            <div>
                <img src="{{ url_for('static', filename='images/LogoHSKHero2.png') }}" alt="HSK Hero Logo" class="logo">
                
            </div>
            <div>
                <img src="" alt="Profile">
            </div>
        </nav>
    </header>
    <main>
        <section>
            <p>You haven't started any levels yet.</p>
            <div class="HSK2_0">
                <h2 class="header_selected_levels_currentHSK">HSK 2.0 - Current version</h2>
                <ol>
                    <li>Level 1</li>
                    <li>Level 2</li>
                    <li>Level 3</li>
                    <li>Level 4</li>
                    <li>Level 5</li>
                    <li>Level 6</li>
                </ol>
            </div>
            <div class="HSK3_0">
                <h2 class="header_selected_levels_newHSK">HSK 3.0 - New version</h2>
                <ol>
                    <li>Level 1</li>
                    <li>Level 2</li>
                    <li>Level 3</li>
                    <li>Level 4</li>
                    <li>Level 5</li>
                    <li>Level 6</li>
                    <li>Levels 7 - 9</li>
                </ol>
            </div>
            <button id="levelBtn">Add New Level</button>
            <div id="levelSelectionBtn" class="levelSelectionBtn">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2>HSK 2.0 (Current version)</h2>
                    <form id="levelForm_current">
                        <label><input type="checkbox" name="level" value="current Level 1"> Level 1</label><br>
                        <label><input type="checkbox" name="level" value="current Level 2"> Level 2</label><br>
                        <label><input type="checkbox" name="level" value="current Level 3"> Level 3</label><br>
                        <label><input type="checkbox" name="level" value="current Level 4"> Level 4</label><br>
                        <label><input type="checkbox" name="level" value="current Level 5"> Level 5</label><br>
                        <label><input type="checkbox" name="level" value="current Level 6"> Level 6</label><br>
                    </form>
                    <h2>HSK 3.0 (New version)</h2>
                    <form id="levelForm_new">
                        <label><input type="checkbox" name="level" value="new Level 1"> Level 1</label><br>
                        <label><input type="checkbox" name="level" value="new Level 2"> Level 2</label><br>
                        <label><input type="checkbox" name="level" value="new Level 3"> Level 3</label><br>
                        <label><input type="checkbox" name="level" value="new Level 4"> Level 4</label><br>
                        <label><input type="checkbox" name="level" value="new Level 5"> Level 5</label><br>
                        <label><input type="checkbox" name="level" value="new Level 6"> Level 6</label><br>
                        <label><input type="checkbox" name="level" value="new Level 7-9"> Level 7 - 9</label><br>
                    </form>
                    <br>
                    <button type="submit">Confirm</button>
                </div>
            </div>
        </section>
    </main>
    <script>
        const levelSelectionBtn = document.getElementById("levelSelectionBtn");
        const openBtn = document.getElementById("levelBtn");
        const closeBtn = document.querySelector(".levelSelectionBtn .close");

        // Open modal
        openBtn.onclick = () => {
            levelSelectionBtn.style.display = "block";
        }

        // Close modal
        closeBtn.onclick = () => {
            levelSelectionBtn.style.display = "none";
        }

        // Close modal when clicking outside of modal content
        window.onclick = (event) => {
            if (event.target == levelSelectionBtn) {
            levelSelectionBtn.style.display = "none";
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const currentForm = document.querySelector("#levelForm_current");
            const newForm = document.querySelector("#levelForm_new");

            const currentHeader = document.querySelector(".header_selected_levels_currentHSK");
            const newHeader = document.querySelector(".header_selected_levels_newHSK");

            const currentLevelsList = document.querySelector(".HSK2_0 ol");
            const newLevelsList = document.querySelector(".HSK3_0 ol");

            // Hide all levels initially
            currentLevelsList.querySelectorAll("li").forEach(li => li.style.display = "none");
            newLevelsList.querySelectorAll("li").forEach(li => li.style.display = "none");

            function updateVisibility(form, header, levelsList, storageKey) {
                const checkboxes = form.querySelectorAll("input[type='checkbox']");
                let anyChecked = false;
                let selectedValues = [];

                checkboxes.forEach((cb, i) => {
                    if (cb.checked) {
                        levelsList.children[i].style.display = "list-item";
                        anyChecked = true;
                        selectedValues.push(cb.value);
                    } else {
                        levelsList.children[i].style.display = "none";
                    }
                });

                // Save selections in localStorage
                localStorage.setItem(storageKey, JSON.stringify(selectedValues));

                // Toggle header visibility
                header.style.display = anyChecked ? "block" : "none";
            }

            function restoreSelections(form, header, levelsList, storageKey) {
                const savedSelections = JSON.parse(localStorage.getItem(storageKey) || "[]");
                const checkboxes = form.querySelectorAll("input[type='checkbox']");

                checkboxes.forEach((cb, i) => {
                    cb.checked = savedSelections.includes(cb.value);
                    levelsList.children[i].style.display = cb.checked ? "list-item" : "none";
                });

                // Show header if any saved selections
                header.style.display = savedSelections.length > 0 ? "block" : "none";
            }

            // Restore selections on load
            restoreSelections(currentForm, currentHeader, currentLevelsList, "currentLevels");
            restoreSelections(newForm, newHeader, newLevelsList, "newLevels");

            // Event listeners for updates
            currentForm.addEventListener("change", () => {
                updateVisibility(currentForm, currentHeader, currentLevelsList, "currentLevels");
            });

            newForm.addEventListener("change", () => {
                updateVisibility(newForm, newHeader, newLevelsList, "newLevels");
            });

            document.querySelector(".modal-content button[type='submit']").addEventListener("click", (e) => {
                e.preventDefault();

                const selectedLevels = [
                    ...Array.from(document.querySelectorAll("#levelForm_current input:checked")),
                    ...Array.from(document.querySelectorAll("#levelForm_new input:checked"))
                ].map(input => input.value);

                alert("Selected levels: " + selectedLevels.join(", "));
                levelSelectionBtn.style.display = "none";
            });
        });
        </script>
</body>
</html>